<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
          "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets">

<h:body>

	<ui:composition xmlns="http://www.w3.org/1999/xhtml"
		xmlns:h="http://java.sun.com/jsf/html"
		xmlns:f="http://java.sun.com/jsf/core"
		xmlns:c="http://java.sun.com/jsp/jstl/core"
		xmlns:p="http://primefaces.org/ui">
		
		<h:panelGroup id="resultClusterPanel" layout="block">
			<!-- <h:panelGroup rendered="#{metFragWebBean.compoundsClusterReady}"> -->
			<h:panelGroup rendered="false">
				<p:tree id="compoundClusterTree" value="#{metFragWebBean.compoundsClusterRoot}" var="node" orientation="horizontal" 
					selectionMode="checkbox" selection="#{metFragWebBean.selectedClusterNodes}" dynamic="true" >
					
		        	<p:ajax event="expand" listener="#{metFragWebBean.nodeExpand}" />
		    		<p:ajax event="collapse" listener="#{metFragWebBean.nodeCollapse}" />
		        
		        	<p:treeNode type="leaf">
			           	<h:outputText value="#{node.name}" style="color: red;" />
			    	</p:treeNode>
				   		
		           	<p:treeNode type="node">
			           	<h:outputText value="#{node.maxScore}" />
			    	</p:treeNode>
					
		    	</p:tree>
		    	<p:contextMenu for="compoundClusterTree">
		        	<p:menuitem value="Filter selected nodes" actionListener="#{metFragWebBean.displaySelectedClusterCompounds(metFragWebBean.selectedClusterNodes)}" />
		    	 	<p:menuitem value="Expand selected nodes" update="mainForm:mainAccordion:resultClusterPanel" actionListener="#{metFragWebBean.expandSelectedClusterCompounds(metFragWebBean.selectedClusterNodes)}" />
		    	 	<p:menuitem value="Collapse selected nodes" update="mainForm:mainAccordion:resultClusterPanel" actionListener="#{metFragWebBean.collapseSelectedClusterCompounds(metFragWebBean.selectedClusterNodes)}" />
		    	</p:contextMenu>
				
			</h:panelGroup>
		<!-- <h:panelGroup rendered="#{not metFragWebBean.compoundsClusterReady}"> -->
			<h:panelGroup>
	    		<h:outputStylesheet name='css/loader.css'  rel='stylesheet' type='text/css' target="head"/>
	    		
	    		<!-- <p:graphicImage name="images/loading.gif"/> -->
	    		<div class="container">
	    			<div class="cell">
	    				<div class="loader square reg">
	    					<div class="block">
	    						<div class="box">
	    						</div>
	    					</div>
	    				</div>
	    			</div>	
	    			Loading...
	    		</div>
	    		
			</h:panelGroup>
		  </h:panelGroup>	

		<h:outputScript library="primefaces" name="jquery/jquery.js" target="head" />
   		<h:outputScript target="head" >
	   		$( document ).ready(function() {
	
				var box = $('#mainForm').children('div').eq(0).children('div').eq(5).children('div').eq(0).children('div').eq(0).children('table').eq(0);
				
				box.offset({
				    left: 100,
				    top: 75
				});
				
				var drag = {
				    elem: null,
				    x: 0,
				    y: 0,
				    state: false
				};
				var delta = {
				    x: 0,
				    y: 0
				};
				
				box.mousedown(function(e) {
				    if (!drag.state) {
				        drag.elem = this;
				        this.style.backgroundColor = '#f00';
				        drag.x = e.pageX;
				        drag.y = e.pageY;
				        drag.state = true;
				    }
				    return false;
				});
				
				
				$(document).mousemove(function(e) {
				    if (drag.state) {
				        drag.elem.style.backgroundColor = '#f0f';
				
				        delta.x = e.pageX - drag.x;
				        delta.y = e.pageY - drag.y;
				
				        var cur_offset = $(drag.elem).offset();
				
				        $(drag.elem).offset({
				            left: (cur_offset.left + delta.x),
				            top: (cur_offset.top + delta.y)
				        });
				
				        drag.x = e.pageX;
				        drag.y = e.pageY;
				    }
				});
				
				$(document).mouseup(function() {
				    if (drag.state) {
				        drag.elem.style.backgroundColor = '#808';
				    drag.state = false;
				}
				});
			});
	   	</h:outputScript>

 	</ui:composition>
</h:body>

</html>
